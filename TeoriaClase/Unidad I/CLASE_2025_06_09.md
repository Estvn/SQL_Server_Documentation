
- Son una estructura temporal que se guarda en la memoria como resultado de una consulta SELECT.
- Es una estructura que se guarda en la memoria, y se opera de registro a registro.

- **Como buena práctica, el cursor se cierra al principio.**
- FETCH sirve para ir iterando de registro a registro.

- SENSITIVE indica que no se modifiquen los datos que se leen.
- SCROLL permite ir haciendo la lectura de forma ascendente o descendente.
- READ ONLY cada registro que se lee en el cursor solo puede ser leído.

#### Consideraciones de Cursor

- **Fila por fila.** Un cursos se usa cuando se quiere hacer una lectura de fila por fila para hacer una actualización, por ejemplo.
- **Bloqueo de recursos.** El uso de los cursores puede generar bloqueos en los recursos afectados por las operaciones del mismo.
- **Consumo de memoria.** Puede saturar la memoria si son demasiados registros.
- **Latencia de red.** Cuando accedemos a un cursor y la base de datos está en un servidor alojado en la nube, el cursor puede generar latencia.

```
-- 1. Declarar el cursor
DECLARE cursor_orders SCROLL CURSOR
FOR SELECT * FROM dbo.orders

-- 2. Abrir el cursor
OPEN cursor_orders

-- 3. Iterar las filas de una en una 
FETCH NEXT FROM cursor_orders -- iterando de registro a registro
CLOSE cursor_orders

-- 4. Liberar el cursor de la memoria
DEALLOCATE cursor_orders
```

- Si ejecutamos el cursor con el FETCH, podemos ejecutarlo varias veces, y siempre trae el siguiente elemento.
- **No se puede abrir el cursor si ya está abierto.**

```
declare @codigo varchar(5),
		@companna varchar(40),
		@pais varchar(15)

declare cursor_customers cursor for select customer_id, company_name, contact_name, country
from customers
go
```

```
declare @codigo varchar(5),
		@companna varchar(40),
		@contacto varchar(40),
		@pais varchar(15)

open cursor_customers
fetch cursor_customers into @codigo, @companna, @contacto, @pais
while @@FETCH_STATUS = 0

begin 
	print concat(
				"El cliente tiene código: ",@codigo,
				" compañía: ", @companna,
				" contacto: ", @contacto,
				" pais: ", @pais)
	fetch cursor_customers into @codigo, @companna, @contacto, @pais
end

close cursor_customers
deallocate cursor_customers
```

- **Los cursores los usaremos para actualización, cuando el select sea de una sola tabla.**
- 






